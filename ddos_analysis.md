# 友商技术分析：
---
* 来源：https://www.dptech.com/index.php?m=content&c=index&a=show&catid=641&id=35
---
## 指纹识别防护
```
数据包的网络层、传输层中有很多字段，包括报文长度、TTL、源目的端口等信息，甚至包括数据段的一些信息，在不同的网络中，都是具有自己的统计特征的，这些信息就是指纹。指纹识别防护的基本思想在于根据正常网络流量的指纹建立防护模型，当网络异常的时候，提取出异常指纹和防护模型进行对比，对超过防护模型的数据包进行过滤。

例如针对报文长度，可在清洗设备Guard3000接收到报文后，提取出报文长度，将报文长度字段进行离散化存储，然后定时统计出当前网络下报文长度的分布模型。当网络出现异常的时候，会有某一种指纹分布出现波动，超过我们建立的分布模型值，这时就可以根据这个指纹特征对异常报文进行过滤。

仅采用单个指纹特征的进行防护的效果有时可能不理想，所以可采用多个报文特征聚合成一个指纹特征的方法，例如源IP和TTL组合成一个整体，作为一个指纹进行统计过滤，这样对于一些复杂的异常流量攻击会有更好的效果。
```
* 分析
```
比较实用的一个功能，防护网络层的攻击（在现网上应该有80%以上）效果很好。
在应付集采测试时效果很好：仪表为了追求性能极致，会充分利用cpu的cache，很多字段并不会全随机（每次随机都会耗费cpu资源，刷新cpu的cache）。
为什么多数攻击都有特征（专业的除外）？
1. DDoS门槛低，多数人都认为没有技术含量，所以选择工具都比较随意（一般都是黑产市场上售卖的）。
2. 黑产市场上售卖的工具只关注攻击流量大小和攻击类型，并不太关注攻击细节（比方说攻击包的字段是否全随机等），针对防护算法的工具就更少了（只有部分工具会试图挑战应用层的防护机制）。
3. 为了追求性能极致，某些攻击工具或测试仪表会固定某些字段，以充分利用cpu的cache，来实现性能最大化。

结合了流量分析的思想，学习正常流量，识别异常流量，方案可简单可复杂：
简单方案（可以用于应付集采）：比方说，正常情况下，TTL一般是比较随机，假如攻击的TTL不是随机的，那会在某个范围（比方说248～254）出现一个明显的峰值（远超正常流量），可以用很简单的计算机算法就能识别出来，对性能影响也不大。
复杂方案：建立学习模型，运用各种高级机器学习算法做分析，决策。（影响性能，学习的也不一定准确，需要不断迭代）。
```

## DNS域名限速
```
支持按照DNS的每个域名进行单独限速。这个限速还可以支持通配符，以支持域名部分随机的情况。
```
* 分析
```
在特定场景下比较实用（比方说集采测试），多数情况下，也不太敢用这个功能（随机一个*.baidu.com， 限速就可能造成大量的误杀）
可以结合上面的指纹识别的一个因子。
可以考虑在业务正常的时候缓存DNS域名，在攻击发生的时候，可以用来做过滤。（实现方案考虑一下：bloomfilter）
